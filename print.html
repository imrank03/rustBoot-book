<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rustBoot Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Objectives</li><li class="chapter-item expanded "><a href="objectives.html"><strong aria-hidden="true">1.</strong> Goals</a></li><li class="chapter-item expanded "><a href="features.html"><strong aria-hidden="true">2.</strong> Features</a></li><li class="chapter-item expanded affix "><li class="part-title">Design and Architecture Overview</li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">3.</strong> Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="design/core_components.html"><strong aria-hidden="true">3.1.</strong> Components of rustBoot</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="arch/images.html"><strong aria-hidden="true">4.1.</strong> rustBoot Images</a></li><li class="chapter-item expanded "><a href="arch/partitions.html"><strong aria-hidden="true">4.2.</strong> rustBoot Partitions</a></li><li class="chapter-item expanded "><a href="arch/boot_flow.html"><strong aria-hidden="true">4.3.</strong> rustBoot Secure-Boot Flow</a></li><li class="chapter-item expanded "><a href="arch/update_flow.html"><strong aria-hidden="true">4.4.</strong> rustBoot Secure-Update Flow</a></li><li class="chapter-item expanded "><a href="arch/signing_utilities.html"><strong aria-hidden="true">4.5.</strong> Signing Utilities</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="user_guide.html"><strong aria-hidden="true">5.</strong> User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/nrf52840.html"><strong aria-hidden="true">5.1.</strong> nrf52840</a></li><li class="chapter-item expanded "><a href="usage/rpi4.html"><strong aria-hidden="true">5.2.</strong> rpi4</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Coding Guidelines and Testing</li><li class="chapter-item expanded "><a href="coding_guide.html"><strong aria-hidden="true">6.</strong> Coding guidelines</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li class="chapter-item expanded affix "><li class="part-title">Continuous Integration</li><li class="chapter-item expanded "><a href="continuous-integration.html"><strong aria-hidden="true">8.</strong> Continuous Integration</a></li><li class="chapter-item expanded affix "><li class="part-title">For Developers</li><li class="chapter-item expanded "><a href="for_developers/index.html"><strong aria-hidden="true">9.</strong> For Developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="for_developers/ref_guide.html"><strong aria-hidden="true">9.1.</strong> Reference Guide</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="misc/contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">rustBoot Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nihalpasham/rustBoot-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rustboot"><a class="header" href="#rustboot">rustBoot</a></h1>
<p><em>by Nihal Pasham</em> </p>
<p>rustBoot is a standalone bootloader, written entirely in <code>Rust</code>, designed to run on anything from a microcontroller to a system on chip. It can be used to boot into bare-metal firmware or Linux.</p>
<h2 id="why-rustboot"><a class="header" href="#why-rustboot">Why rustBoot?</a></h2>
<p>rustBoot prioritizes the following above all else.</p>
<ul>
<li>keep only the bare-essentials</li>
<li>secure by default</li>
<li>low-integration complexity</li>
</ul>
<p><code>rustBoot</code> does the bare minimum needed to securely boot bare-metal firmware (or Linux) i.e. it has a really small <code>trusted computing base</code>. It is secure by default i.e. it <code>does not boot digitally unsigned firmware</code> and uses <code>memory-safe implementations</code> (for crypto and boot-logic) as the default. It also attempts to eliminate the high degree of integration-complexity involved in rolling a production-grade bootloader by adopting a <code>batteries-included</code> approach. </p>
<ul>
<li><em>For example, we include <code>flash device drivers for all supported boards</code> written in safe Rust.</em></li>
</ul>
<h2 id="why-prioritize-the-above"><a class="header" href="#why-prioritize-the-above">Why prioritize the above?</a></h2>
<h3 id="trusted-computing-base"><a class="header" href="#trusted-computing-base">Trusted Computing Base:</a></h3>
<p>Open-source bootloaders have a large trusted computing base i.e. they (pretty much) resemble a mini operating system with </p>
<ul>
<li>a complete networking stack</li>
<li>a collection of device drivers and device-tree blob(s)</li>
<li>integrated debug and command shells</li>
<li>support for every possible filesystem you can think of.   </li>
<li>and more stuff.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> This includes <a href="https://github.com/u-boot/u-boot"><code>U-boot</code></a>, the de-facto standard in the embedded-systems world. Here’s a mental map of Uboot’s potential attack surface. </p>
<ul>
<li><a href="https://github.com/u-boot/u-boot"><code>DepthCharge</code></a> is a U-Boot hacking toolkit for security researchers and tinkerers designed to exploit this large attack surface. 
<img src="https://user-images.githubusercontent.com/20253082/156697312-3458f778-508a-44c6-ac1c-c4fcfce141bd.png" alt="mental_map_uboot_attack_surface" /></li>
</ul>
</blockquote>
<h3 id="memory-safety"><a class="header" href="#memory-safety">Memory safety:</a></h3>
<p>A large TCB inevitably equates to a large attack surface. The vast majority of them are written in C or some combination of C and Assembly. <code>A quick analysis of CVEs</code> reported over the last 2 years (in u-boot, bare-box and other open-source ones) show that the bulk of them fall into the memory-safety category. </p>
<blockquote>
<p><strong>Note:</strong> <code>addressable attack surface</code> is much larger, the above <code>attack surface</code> is only compounded when we add boot-time driver vulnerabilities.</p>
</blockquote>
<h3 id="complexity--boot-time"><a class="header" href="#complexity--boot-time">Complexity &amp; boot-time:</a></h3>
<p>Custom secure boot implementations can <code>get quite complex and add latency</code> with </p>
<ul>
<li>redundant hierarchical digital signature verification trust chains or </li>
<li>elaborate parsing of custom header or container formats.</li>
</ul>
<h3 id="vendor-dependencies"><a class="header" href="#vendor-dependencies">Vendor dependencies:</a></h3>
<p>Vendor-specific or custom chain of trust dependencies make it difficult to port bootloader implementations across boards.  This is in-part attributable to <code>non-standards based solutions</code>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="goals"><a class="header" href="#goals">Goals</a></h1>
<p>Contrary to prevailing wisdom, writing your own secure-bootloader is a complex project. The effort involved in developing/integrating one can be overwhelming. For example, we’ll need to address a plethora of accompanying tasks such as key-management, signing infrastructure, code-safety, trust-chains, reliable back-ups etc. before we even get to the <code>actual booting logic</code>. </p>
<p>rustBoot’s purpose is to help simplify the entire process. Its primary goals are</p>
<ul>
<li>
<p><strong>Complies with <em>some</em> key requirements of the <a href="https://datatracker.ietf.org/wg/suit/about/">IETF-SUIT</a> standard</strong> i.e.</p>
<ul>
<li>one of <code>SUIT's requirements</code> - transferring or downloading an <code>update</code> should be delegated to the firmware/OS to avoid <code>size or computational</code> limitations. In other words, the bootloader should NOT be required to download and install an update. This removes the need for a networking stack and provides for a drastic reduction in the bootloader’s attack surface.</li>
<li>SUIT also does not mandate the use of specific protocols or data link interfaces to transfer <code>updates</code> to a device. </li>
<li>rustBoot fully complies with this requirement. </li>
</ul>
</li>
<li>
<p><strong>Reliable updates:</strong></p>
<ul>
<li>reliable updates in rustBoot will take the form of
<ul>
<li><code>flash swap operations</code> for microcontroller based systems. We’ll use the <code>boot/update based multi-slot partitioning method</code> to replace currently active firmware with a newly received update and at the same time store a back-up copy of it in a (passive) secondary partition.</li>
<li><code>ram swap operations</code> for more powerful system-on-chip boards which can boot Linux. </li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Predictability over Performance:</strong> </p>
<ul>
<li>one of rustBoot’s core design objectives is to keep it simple and avoid complexity. So, there will be little to no application of meta or async programming constructs. </li>
</ul>
<blockquote>
<p><strong>Note:</strong> We don’t actually need the extra performance. rustBoot can hit sub-second <code>secure boot-times</code> as we’ve stripped it down to the bare-essentials. This assumes flash load times are fast enough and a firmware binary-blob size of &lt; 1MB.</p>
</blockquote>
</li>
<li>
<p><strong>Zero-dynamic memory allocation:</strong></p>
<ul>
<li>to make it highly portable, apart from its modular design, rustBoot relies on a zero dynamic memory allocation architecture i.e. no heap required. </li>
</ul>
</li>
<li>
<p><strong>Memory safety &amp; type-state programming:</strong> </p>
<ul>
<li>the entire bootloader is written in rust’s safe-fragment with a limited set of well-defined api(s) for unsafe HW access.</li>
<li>as a consequence, it makes rustBoot immune to a whole host of memory safety bugs. ex: things like parsing image-headers (i.e. container-formats) in rustBoot is much safer.</li>
<li>rustBoot takes advantage of rust’s powerful type-system to make <code>invalid boot-states, unrepresentable at compile time</code> and along with constructs such as sealed states, global singletons, it improves the overall security of the entire code-base.</li>
</ul>
</li>
</ul>
<blockquote>
<p>There is a plan to further add to rustBoot’s high levels of assurance by leveraging <code>formal methods</code> such as</p>
<ul>
<li><code>property-based testing via symbolic execution:</code> to formally verify rustBoot’s parser.</li>
<li><code>deductive verification:</code> for critical sections of code (ex: swapping contents of boot and update partitions).</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h2 id="features-currently-supported"><a class="header" href="#features-currently-supported">Features currently supported:</a></h2>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
support for <code>ARM Cortex-M, Cortex-A</code> micro-architectures</li>
<li><input disabled="" type="checkbox" checked=""/>
support for multi-slot partitioning of microcontroller flash memory. This allows us to implement the <code>boot/update</code> approach for bare-metal <code>firmware updates</code>.</li>
<li><input disabled="" type="checkbox" checked=""/>
support for <code>Aarch64 linux</code> booting</li>
<li><input disabled="" type="checkbox" checked=""/>
elliptic curve cryptography for integrity and authenticity verification using <a href="https://github.com/RustCrypto"><code>RustCrypto</code></a> crates</li>
<li><input disabled="" type="checkbox" checked=""/>
a tiny hardware abstraction layer for non-volatile memory (i.e. flash) access.</li>
<li><input disabled="" type="checkbox" checked=""/>
anti-rollback protection via version numbering.</li>
<li><input disabled="" type="checkbox" checked=""/>
a fully memory safe core-bootloader implementation with safe parsers and firmware-update logic.</li>
<li><input disabled="" type="checkbox" checked=""/>
power-interruptible firmware updates along with the assurance of fall-back availability.</li>
</ul>
<h2 id="features-planned"><a class="header" href="#features-planned">Features planned:</a></h2>
<ul>
<li><input disabled="" type="checkbox"/>
switch to <code>rust-based signing tools</code> for manifest-header creation, key-generation and firmware signing to improve scalability and security (currently examples use a python implementation for this). </li>
<li><input disabled="" type="checkbox"/>
support for external flash devices (ex: SPI flash) and serial/console logging interfaces.</li>
<li><input disabled="" type="checkbox"/>
support for <code>ARM TrustZone-M and A</code> and certified <code>secure hardware elements</code> - microchip ATECC608a, NXP SE050, STSAFE-100</li>
<li><input disabled="" type="checkbox"/>
support for a highly secure and efficient <code>firmware transport</code> method over end-end mutually authenticated and encrypted channels via <a href="https://github.com/ockam-network/ockam/tree/develop/documentation/use-cases/end-to-end-encryption-with-rust#readme">ockam-networking-libraries</a>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design"><a class="header" href="#design">Design</a></h1>
<p><code>rustBoot</code> aims to offer an OS and micro-architecture agnostic (i.e. highly portable) standards-based secure bootloader that’s easy to integrate into existing embedded software projects. Its architecture is designed around the idea – <code>a bootloader handles ONLY the bare-essentials and offloads the rest to systems that are better suited for the job.</code> </p>
<h2 id="what-do-bootloaders-actually-do"><a class="header" href="#what-do-bootloaders-actually-do">What do bootloaders actually do?</a></h2>
<ol>
<li>Initialize bare-minimum requisite hardware. Ex: cpu-core, flash, gpios, uart, (RAM and hardware secure elements if needed).</li>
<li>digitally verify i.e. authenticate code before booting</li>
<li>Boot into firmware or OS i.e. <code>linux or RTOS or bare-metal</code></li>
<li>If an update is available, perform the update and re-boot (with rollback protection in-case of firmware-corruption or if power is interrupted).</li>
</ol>
<p>In this chapter, we’ll talk about rustBoot’s design and its core components.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="components-of-rustboot"><a class="header" href="#components-of-rustboot">Components of rustBoot</a></h2>
<p>At its core, <code>rustBoot</code> is comprised of 4 components</p>
<ul>
<li>the core bootloader</li>
<li>a minimal hardware abstraction layer</li>
<li>fast and safe crypto drivers</li>
<li>rustBoot firmware interface</li>
</ul>
<h3 id="the-core-bootloader"><a class="header" href="#the-core-bootloader">The core bootloader</a></h3>
<ul>
<li>has a tiny trusted computing base i.e. its less than <code>32KB in size</code> when compiled to an executable.</li>
<li>this includes signature-based authentication, reliable firmware updates with rollbacks and protections against downgrades attacks.</li>
</ul>
<h3 id="a-minimal-hardware-abstraction-layer"><a class="header" href="#a-minimal-hardware-abstraction-layer">A minimal hardware abstraction layer</a></h3>
<p>rustBoot provides abstractions for the following hardware classes i.e. it exposes a tiny API for you to easily integrate the following types of hardware.</p>
<ul>
<li>flash memory controllers: NVMC, SPI-flash, EMMC block devices etc.</li>
<li>TrustZone: Cortex-M or Cortex-A </li>
<li>serial interfaces: UART(s), GPIO(s)</li>
</ul>
<blockquote>
<p><strong>Note:</strong> To minimize integrational complexity and enhance security, we already provide a number of different hardware drivers written in safe-rust. So, you can use <code>your own drivers using rust-ffi</code> or use existing ones from the repo.</p>
</blockquote>
<h3 id="fast-and-safe-crypto-drivers"><a class="header" href="#fast-and-safe-crypto-drivers">Fast and safe crypto drivers</a></h3>
<ul>
<li><code>hardware secure elements or accelerators:</code> again, rustBoot offers drivers for crypto hardware or you can use your own.
<ul>
<li>examples of supported vendor-specific crypto modules include <code>ATECC608a</code>.</li>
</ul>
</li>
<li><code>software implementations of crypto-libraries:</code> rustBoot uses the <code>RustCrypto</code> project as its software crypto provider. 
<ul>
<li>This includes all crates in the rustcrypto project - hashing, signing, verification, encryption etc.</li>
</ul>
</li>
</ul>
<h3 id="rustboot-firmware-interface"><a class="header" href="#rustboot-firmware-interface">rustBoot firmware interface</a></h3>
<ul>
<li>rustBoot complies with a key requirement of the <a href="https://datatracker.ietf.org/wg/suit/about/"><strong>IETF-SUIT</strong></a> standard and does not include a networking stack, instead networking is offloaded to the underlying firmware/OS. </li>
<li>Firmware updates are downloaded and stored in non-volatile storage.</li>
<li>In order to trigger the update, rustBoot provides a simple API that can be called from within bare-metal firmware or linux.</li>
</ul>
<blockquote>
<p>Note: In the above context, firmware refers to either linux or bare-metal firmware. </p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="high-level-overview"><a class="header" href="#high-level-overview">High Level Overview</a></h1>
<p>rustBoot’s architecture reflects its focus on <code>simplicity and security above all else</code>. </p>
<p>For a high-level overview, you can think of rustBoot as operating in 2 independent stages. </p>
<ul>
<li><strong>Pre-handover stage:</strong> post power-on, the BootROM (or some other intermediate-stage bootloader) executes and hands control over to <code>rustBoot</code>. This is a stage where <code>rustBoot</code> has full <code>execution control</code>.</li>
<li><strong>Post-handover stage:</strong> firmware has begun executing and has complete <code>execution control</code>. Firmware uses a couple <code>rustBoot</code> dependencies to trigger and confirm updates.</li>
</ul>
<h2 id="pre-handover-stage"><a class="header" href="#pre-handover-stage">Pre-handover stage:</a></h2>
<ul>
<li>rustBoot provides a minimal hardware abstraction layer for a wide range of ARM microcontrollers (STM32, Nordic, Microchip etc.) and microprocessors (rpi4, NXP etc.). The HAL allows peripherals drivers to initialize requisite hardware such as flash memories, UART controllers, GPIO pins etc.</li>
<li>an optional software-based crypto library in-case you don’t need (or use) dedicated crypto hardware.</li>
<li>rustBoot’s core-bootloader houses all of the <code>actual boot-logic</code> such as
<ul>
<li>firmware image <code>integrity and authenticity verification</code> via digital signatures</li>
<li>power-interruptible firmware updates along with the assurance of fall-back availability. </li>
<li><code>FIT-Image and device tree</code> parsing while booting linux.</li>
<li>multi-slot partitioning of microcontroller flash memory</li>
<li><code>anti-rollback protection</code> via version numbering.</li>
</ul>
</li>
</ul>
<pre class="svgbob"><style>text{fill:var(--fg)}</style><svg xmlns="http://www.w3.org/2000/svg" width="960" height="592">
    <style>
        line, path, circle, rect, polygon{stroke:var(--fg);stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter;}text{font-family:Lucida Console;font-size:14px;}rect.backdrop{stroke:none;fill:transparent;}.broken{stroke-dasharray:8;}.filled{fill:black;}.bg_filled{fill:transparent;}.nofill{fill:transparent;}.end_marked_arrow{marker-end:url(#arrow);}.start_marked_arrow{marker-start:url(#arrow);}.end_marked_diamond{marker-end:url(#diamond);}.start_marked_diamond{marker-start:url(#diamond);}.end_marked_circle{marker-end:url(#circle);}.start_marked_circle{marker-start:url(#circle);}.end_marked_open_circle{marker-end:url(#open_circle);}.start_marked_open_circle{marker-start:url(#open_circle);}.end_marked_big_open_circle{marker-end:url(#big_open_circle);}.start_marked_big_open_circle{marker-start:url(#big_open_circle);}
        <!--separator-->
        
    </style>
    <defs>
        <marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,0 0,4 4,2 0,0"></polygon>
        </marker>
        <marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,2 2,0 4,2 2,4 0,2"></polygon>
        </marker>
        <marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="filled"></circle>
        </marker>
        <marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="bg_filled"></circle>
        </marker>
        <marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="3" class="bg_filled"></circle>
        </marker>
    </defs>
    <rect class="backdrop" x="0" y="0" width="960" height="592"></rect>
    <rect x="228" y="72" width="464" height="80" class="solid nofill b" rx="4"></rect>
    <text x="594" y="108" >Embedded</text>
    <text x="602" y="124" >Pub</text>
    <text x="634" y="124" >Key</text>
    <text x="370" y="108" >rustBoot</text>
    <text x="442" y="108" >core</text>
    <text x="386" y="124" >bootloader</text>
    <rect x="548" y="200" width="136" height="32" class="solid nofill" rx="4"></rect>
    <text x="570" y="220" >`RustCrypto`</text>
    <rect x="228" y="296" width="80" height="32" class="solid nofill" rx="4"></rect>
    <text x="242" y="316" >CRYPTO</text>
    <rect x="324" y="296" width="64" height="32" class="solid nofill" rx="4"></rect>
    <text x="338" y="316" >FLASH</text>
    <rect x="404" y="296" width="56" height="32" class="solid nofill" rx="4"></rect>
    <text x="418" y="316" >GPIO</text>
    <rect x="476" y="296" width="56" height="32" class="solid nofill" rx="4"></rect>
    <text x="490" y="316" >UART</text>
    <rect x="228" y="392" width="312" height="96" class="solid nofill" rx="4"></rect>
    <text x="362" y="428" >RUST</text>
    <text x="282" y="460" >Hardware</text>
    <text x="354" y="460" >Abstraction</text>
    <text x="450" y="460" >Layer</text>
    <rect x="228" y="504" width="456" height="64" class="solid nofill" rx="4"></rect>
    <text x="258" y="540" >Secure</text>
    <text x="314" y="540" >Element</text>
    <text x="402" y="540" >+</text>
    <text x="450" y="540" >Hardware</text>
    <path d="M 544,528 A 16,16 0,0,0 544,544" class="nofill"></path>
    <text x="554" y="540" >MCU</text>
    <text x="586" y="540" >or</text>
    <text x="610" y="540" >MPU</text>
    <path d="M 640,528 A 16,16 0,0,1 640,544" class="nofill"></path>
    <circle cx="4" cy="24" r="3" class="nofill"></circle>
    <text x="42" y="28" >Simplified</text>
    <text x="130" y="28" >Block</text>
    <text x="178" y="28" >Diagram,</text>
    <text x="250" y="28" >Pre</text>
    <text x="282" y="28" >handover</text>
    <text x="354" y="28" >stage:</text>
    <text x="770" y="124" >Embedded</text>
    <text x="842" y="124" >in</text>
    <text x="770" y="140" >in</text>
    <text x="794" y="140" >hardware</text>
    <text x="866" y="124" >software</text>
    <text x="938" y="124" >or</text>
    <line x1="232" y1="184" x2="240" y2="184" class="solid"></line>
    <line x1="248" y1="184" x2="256" y2="184" class="solid"></line>
    <line x1="264" y1="184" x2="272" y2="184" class="solid"></line>
    <line x1="280" y1="184" x2="288" y2="184" class="solid"></line>
    <line x1="296" y1="184" x2="304" y2="184" class="solid"></line>
    <line x1="312" y1="184" x2="320" y2="184" class="solid"></line>
    <line x1="328" y1="184" x2="336" y2="184" class="solid"></line>
    <line x1="344" y1="184" x2="352" y2="184" class="solid"></line>
    <line x1="360" y1="184" x2="368" y2="184" class="solid"></line>
    <line x1="376" y1="184" x2="384" y2="184" class="solid"></line>
    <line x1="392" y1="184" x2="400" y2="184" class="solid"></line>
    <line x1="408" y1="184" x2="416" y2="184" class="solid"></line>
    <line x1="424" y1="184" x2="432" y2="184" class="solid"></line>
    <line x1="440" y1="184" x2="448" y2="184" class="solid"></line>
    <line x1="456" y1="184" x2="464" y2="184" class="solid"></line>
    <line x1="472" y1="184" x2="480" y2="184" class="solid"></line>
    <line x1="488" y1="184" x2="496" y2="184" class="solid"></line>
    <line x1="504" y1="184" x2="512" y2="184" class="solid"></line>
    <line x1="520" y1="184" x2="528" y2="184" class="solid"></line>
    <line x1="536" y1="184" x2="544" y2="184" class="solid"></line>
    <line x1="552" y1="184" x2="560" y2="184" class="solid"></line>
    <line x1="568" y1="184" x2="576" y2="184" class="solid"></line>
    <line x1="584" y1="184" x2="592" y2="184" class="solid"></line>
    <line x1="600" y1="184" x2="608" y2="184" class="solid"></line>
    <line x1="616" y1="184" x2="624" y2="184" class="solid"></line>
    <line x1="632" y1="184" x2="640" y2="184" class="solid"></line>
    <line x1="648" y1="184" x2="656" y2="184" class="solid"></line>
    <line x1="664" y1="184" x2="672" y2="184" class="solid"></line>
    <line x1="680" y1="184" x2="688" y2="184" class="solid"></line>
    <line x1="612" y1="240" x2="612" y2="256" class="solid"></line>
    <line x1="600" y1="264" x2="608" y2="264" class="solid"></line>
    <line x1="616" y1="264" x2="624" y2="264" class="solid"></line>
    <line x1="612" y1="272" x2="612" y2="368" class="solid"></line>
    <line x1="224" y1="376" x2="232" y2="376" class="solid"></line>
    <line x1="240" y1="376" x2="248" y2="376" class="solid"></line>
    <line x1="256" y1="376" x2="264" y2="376" class="solid"></line>
    <line x1="272" y1="376" x2="280" y2="376" class="solid"></line>
    <line x1="288" y1="376" x2="296" y2="376" class="solid"></line>
    <line x1="304" y1="376" x2="312" y2="376" class="solid"></line>
    <line x1="320" y1="376" x2="328" y2="376" class="solid"></line>
    <line x1="336" y1="376" x2="344" y2="376" class="solid"></line>
    <line x1="352" y1="376" x2="360" y2="376" class="solid"></line>
    <line x1="368" y1="376" x2="376" y2="376" class="solid"></line>
    <line x1="384" y1="376" x2="392" y2="376" class="solid"></line>
    <line x1="400" y1="376" x2="408" y2="376" class="solid"></line>
    <line x1="416" y1="376" x2="424" y2="376" class="solid"></line>
    <line x1="432" y1="376" x2="440" y2="376" class="solid"></line>
    <line x1="448" y1="376" x2="456" y2="376" class="solid"></line>
    <line x1="464" y1="376" x2="472" y2="376" class="solid"></line>
    <line x1="480" y1="376" x2="488" y2="376" class="solid"></line>
    <line x1="496" y1="376" x2="504" y2="376" class="solid"></line>
    <line x1="512" y1="376" x2="520" y2="376" class="solid"></line>
    <line x1="528" y1="376" x2="536" y2="376" class="solid"></line>
    <line x1="544" y1="376" x2="552" y2="376" class="solid"></line>
    <line x1="608" y1="376" x2="616" y2="376" class="solid"></line>
    <text x="50" y="204" >Optional</text>
    <text x="122" y="204" >Software</text>
    <text x="98" y="220" >based</text>
    <text x="66" y="236" >crypto</text>
    <text x="122" y="236" >library</text>
    <line x1="232" y1="264" x2="240" y2="264" class="solid"></line>
    <line x1="248" y1="264" x2="256" y2="264" class="solid"></line>
    <line x1="264" y1="264" x2="272" y2="264" class="solid"></line>
    <line x1="280" y1="264" x2="288" y2="264" class="solid"></line>
    <line x1="296" y1="264" x2="304" y2="264" class="solid"></line>
    <line x1="312" y1="264" x2="320" y2="264" class="solid"></line>
    <line x1="328" y1="264" x2="336" y2="264" class="solid"></line>
    <line x1="344" y1="264" x2="352" y2="264" class="solid"></line>
    <line x1="360" y1="264" x2="368" y2="264" class="solid"></line>
    <line x1="376" y1="264" x2="384" y2="264" class="solid"></line>
    <line x1="392" y1="264" x2="400" y2="264" class="solid"></line>
    <line x1="408" y1="264" x2="416" y2="264" class="solid"></line>
    <line x1="424" y1="264" x2="432" y2="264" class="solid"></line>
    <line x1="440" y1="264" x2="448" y2="264" class="solid"></line>
    <line x1="456" y1="264" x2="464" y2="264" class="solid"></line>
    <line x1="472" y1="264" x2="480" y2="264" class="solid"></line>
    <line x1="488" y1="264" x2="496" y2="264" class="solid"></line>
    <line x1="504" y1="264" x2="512" y2="264" class="solid"></line>
    <line x1="520" y1="264" x2="528" y2="264" class="solid"></line>
    <line x1="536" y1="264" x2="544" y2="264" class="solid"></line>
    <line x1="552" y1="264" x2="560" y2="264" class="solid"></line>
    <line x1="568" y1="264" x2="576" y2="264" class="solid"></line>
    <line x1="584" y1="264" x2="592" y2="264" class="solid"></line>
    <line x1="632" y1="264" x2="640" y2="264" class="solid"></line>
    <line x1="648" y1="264" x2="656" y2="264" class="solid"></line>
    <line x1="664" y1="264" x2="672" y2="264" class="solid"></line>
    <line x1="680" y1="264" x2="688" y2="264" class="solid"></line>
    <text x="50" y="300" >Peripheral</text>
    <text x="66" y="316" >Drivers</text>
    <line x1="560" y1="376" x2="568" y2="376" class="solid"></line>
    <line x1="576" y1="376" x2="584" y2="376" class="solid"></line>
    <line x1="592" y1="376" x2="600" y2="376" class="solid"></line>
    <line x1="624" y1="376" x2="632" y2="376" class="solid"></line>
    <line x1="640" y1="376" x2="648" y2="376" class="solid"></line>
    <line x1="656" y1="376" x2="664" y2="376" class="solid"></line>
    <line x1="672" y1="376" x2="680" y2="376" class="solid"></line>
    <text x="18" y="428" >Board</text>
    <text x="66" y="428" >specific</text>
    <text x="50" y="444" >HAL</text>
    <g>
        <line x1="8" y1="24" x2="16" y2="24" class="solid"></line>
        <polygon points="16,20 24,24 16,28" class="filled"></polygon>
    </g>
    <g>
        <path d="M 584,88 A 4,4 0,0,0 580,92" class="nofill"></path>
        <line x1="580" y1="92" x2="580" y2="132" class="solid"></line>
        <line x1="584" y1="88" x2="672" y2="88" class="solid"></line>
        <path d="M 672,88 A 4,4 0,0,1 676,92" class="nofill"></path>
        <line x1="676" y1="92" x2="676" y2="132" class="solid"></line>
        <line x1="676" y1="120" x2="752" y2="120" class="solid"></line>
        <polygon points="752,116 760,120 752,124" class="filled"></polygon>
        <path d="M 580,132 A 4,4 0,0,0 584,136" class="nofill"></path>
        <line x1="584" y1="136" x2="672" y2="136" class="solid"></line>
        <path d="M 676,132 A 4,4 0,0,1 672,136" class="nofill"></path>
    </g>
    <g>
        <line x1="268" y1="336" x2="268" y2="356" class="solid"></line>
        <polygon points="264,356 272,356 268,368" class="filled"></polygon>
    </g>
    <g>
        <line x1="364" y1="336" x2="364" y2="356" class="solid"></line>
        <polygon points="360,356 368,356 364,368" class="filled"></polygon>
    </g>
    <g>
        <line x1="436" y1="336" x2="436" y2="356" class="solid"></line>
        <polygon points="432,356 440,356 436,368" class="filled"></polygon>
    </g>
    <g>
        <line x1="508" y1="336" x2="508" y2="356" class="solid"></line>
        <polygon points="504,356 512,356 508,368" class="filled"></polygon>
    </g>
    <g>
        <line x1="612" y1="384" x2="612" y2="484" class="solid"></line>
        <polygon points="608,484 616,484 612,496" class="filled"></polygon>
    </g>
    <g>
        <polygon points="232,212 224,216 232,220" class="filled"></polygon>
        <line x1="232" y1="216" x2="520" y2="216" class="solid"></line>
    </g>
    <g>
        <polygon points="144,308 136,312 144,316" class="filled"></polygon>
        <line x1="144" y1="312" x2="208" y2="312" class="solid"></line>
    </g>
    <g>
        <polygon points="144,436 136,440 144,444" class="filled"></polygon>
        <line x1="144" y1="440" x2="208" y2="440" class="solid"></line>
    </g>
</svg></pre>
<h2 id="post-handover-stage"><a class="header" href="#post-handover-stage">Post-handover stage:</a></h2>
<ul>
<li>At this stage, control has been handed over to firmware (or linux).</li>
<li>rustBoot <code>does not</code> have a networking stack. The job of downloading and installing an update is offloaded to firmware or linux (<a href="index.html#trusted-computing-base"><code>drastically reducing the TCB</code></a>)</li>
<li>Firmware can trigger and confirm updates by setting the state of the <code>update</code> partition via a rustBoot api. This removes the need for a filesystem (<a href="index.html#trusted-computing-base"><code>again smaller TCB</code></a>). 
<ul>
<li>However, not all systems can boot without a file-system. </li>
<li>If you need one, rustBoot offers a FAT 16/32 implementation, written in safe rust. </li>
</ul>
</li>
<li>Once an update is triggered, the device is reset (i.e. restarted). rustBoot takes over and attempts to verify the update. If everything checks out, it boots the updated firmware.</li>
</ul>
<pre class="svgbob"><style>text{fill:var(--fg)}</style><svg xmlns="http://www.w3.org/2000/svg" width="928" height="544">
    <style>
        line, path, circle, rect, polygon{stroke:var(--fg);stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter;}text{font-family:Lucida Console;font-size:14px;}rect.backdrop{stroke:none;fill:transparent;}.broken{stroke-dasharray:8;}.filled{fill:black;}.bg_filled{fill:transparent;}.nofill{fill:transparent;}.end_marked_arrow{marker-end:url(#arrow);}.start_marked_arrow{marker-start:url(#arrow);}.end_marked_diamond{marker-end:url(#diamond);}.start_marked_diamond{marker-start:url(#diamond);}.end_marked_circle{marker-end:url(#circle);}.start_marked_circle{marker-start:url(#circle);}.end_marked_open_circle{marker-end:url(#open_circle);}.start_marked_open_circle{marker-start:url(#open_circle);}.end_marked_big_open_circle{marker-end:url(#big_open_circle);}.start_marked_big_open_circle{marker-start:url(#big_open_circle);}
        <!--separator-->
        .r1{ 
    stroke: papayawhip;
 }
.r2{ 
    fill: crimson;
 }
.a{ 
    stroke-dasharray: 8;
    fill: lightblue;
 }
.b{ 
    stroke: purple;
 }
.bigrect{ 
    fill: yellow;
    stroke: red;
 }
.red{ 
    fill:red;
    stroke:blue;
 }
    </style>
    <defs>
        <marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,0 0,4 4,2 0,0"></polygon>
        </marker>
        <marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,2 2,0 4,2 2,4 0,2"></polygon>
        </marker>
        <marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="filled"></circle>
        </marker>
        <marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="bg_filled"></circle>
        </marker>
        <marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="3" class="bg_filled"></circle>
        </marker>
    </defs>
    <rect class="backdrop" x="0" y="0" width="928" height="544"></rect>
    <rect x="228" y="72" width="472" height="80" class="solid nofill" rx="4"></rect>
    <rect x="252" y="88" width="56" height="48" class="solid nofill" rx="4"></rect>
    <text x="266" y="108" >Apps</text>
    <rect x="340" y="88" width="168" height="48" class="solid nofill" rx="4"></rect>
    <text x="354" y="108" >App</text>
    <text x="386" y="108" >to</text>
    <text x="410" y="108" >download</text>
    <text x="354" y="124" >and</text>
    <text x="386" y="124" >install</text>
    <text x="450" y="124" >update</text>
    <rect x="532" y="88" width="152" height="48" class="solid nofill" rx="4"></rect>
    <text x="546" y="108" >App</text>
    <text x="578" y="108" >to</text>
    <text x="602" y="108" >trigger</text>
    <text x="666" y="108" >&amp;</text>
    <text x="554" y="124" >confirm</text>
    <text x="618" y="124" >updates</text>
    <rect x="540" y="184" width="136" height="48" class="solid nofill b" rx="4"></rect>
    <text x="554" y="204" >rustBoot</text>
    <text x="626" y="204" >flash</text>
    <text x="594" y="220" >API</text>
    <rect x="228" y="296" width="48" height="32" class="solid nofill" rx="4"></rect>
    <text x="242" y="316" >TCP</text>
    <rect x="292" y="296" width="48" height="32" class="solid nofill" rx="4"></rect>
    <text x="306" y="316" >UDP</text>
    <rect x="356" y="296" width="152" height="32" class="solid nofill" rx="4"></rect>
    <text x="370" y="316" >Custom</text>
    <text x="426" y="316" >Transport</text>
    <rect x="228" y="376" width="448" height="64" class="solid nofill" rx="4"></rect>
    <text x="338" y="412" >Linux</text>
    <text x="386" y="412" >or</text>
    <text x="410" y="412" >Baremetal</text>
    <text x="490" y="412" >Firmware</text>
    <rect x="228" y="456" width="456" height="64" class="solid nofill" rx="4"></rect>
    <text x="258" y="492" >Secure</text>
    <text x="314" y="492" >Element</text>
    <text x="402" y="492" >+</text>
    <text x="450" y="492" >Hardware</text>
    <path d="M 544,480 A 16,16 0,0,0 544,496" class="nofill"></path>
    <text x="554" y="492" >MCU</text>
    <text x="586" y="492" >or</text>
    <text x="610" y="492" >MPU</text>
    <path d="M 640,480 A 16,16 0,0,1 640,496" class="nofill"></path>
    <circle cx="4" cy="24" r="3" class="nofill"></circle>
    <text x="42" y="28" >Simplified</text>
    <text x="130" y="28" >Block</text>
    <text x="178" y="28" >Diagram,</text>
    <text x="250" y="28" >Post</text>
    <text x="290" y="28" >handover</text>
    <text x="362" y="28" >stage:</text>
    <line x1="428" y1="144" x2="428" y2="160" class="solid"></line>
    <line x1="232" y1="168" x2="240" y2="168" class="solid"></line>
    <line x1="248" y1="168" x2="256" y2="168" class="solid"></line>
    <line x1="264" y1="168" x2="272" y2="168" class="solid"></line>
    <line x1="280" y1="168" x2="288" y2="168" class="solid"></line>
    <line x1="296" y1="168" x2="304" y2="168" class="solid"></line>
    <line x1="312" y1="168" x2="320" y2="168" class="solid"></line>
    <line x1="328" y1="168" x2="336" y2="168" class="solid"></line>
    <line x1="344" y1="168" x2="352" y2="168" class="solid"></line>
    <line x1="360" y1="168" x2="368" y2="168" class="solid"></line>
    <line x1="376" y1="168" x2="384" y2="168" class="solid"></line>
    <line x1="392" y1="168" x2="400" y2="168" class="solid"></line>
    <line x1="408" y1="168" x2="416" y2="168" class="solid"></line>
    <line x1="424" y1="168" x2="432" y2="168" class="solid"></line>
    <line x1="440" y1="168" x2="448" y2="168" class="solid"></line>
    <line x1="456" y1="168" x2="464" y2="168" class="solid"></line>
    <line x1="472" y1="168" x2="480" y2="168" class="solid"></line>
    <line x1="488" y1="168" x2="496" y2="168" class="solid"></line>
    <line x1="504" y1="168" x2="512" y2="168" class="solid"></line>
    <line x1="520" y1="168" x2="528" y2="168" class="solid"></line>
    <line x1="536" y1="168" x2="544" y2="168" class="solid"></line>
    <line x1="552" y1="168" x2="560" y2="168" class="solid"></line>
    <line x1="568" y1="168" x2="576" y2="168" class="solid"></line>
    <line x1="584" y1="168" x2="592" y2="168" class="solid"></line>
    <line x1="632" y1="168" x2="640" y2="168" class="solid"></line>
    <line x1="648" y1="168" x2="656" y2="168" class="solid"></line>
    <line x1="664" y1="168" x2="672" y2="168" class="solid"></line>
    <line x1="680" y1="168" x2="688" y2="168" class="solid"></line>
    <line x1="612" y1="240" x2="612" y2="256" class="solid"></line>
    <line x1="232" y1="264" x2="240" y2="264" class="solid"></line>
    <line x1="248" y1="264" x2="256" y2="264" class="solid"></line>
    <line x1="264" y1="264" x2="272" y2="264" class="solid"></line>
    <line x1="280" y1="264" x2="288" y2="264" class="solid"></line>
    <line x1="296" y1="264" x2="304" y2="264" class="solid"></line>
    <line x1="312" y1="264" x2="320" y2="264" class="solid"></line>
    <line x1="328" y1="264" x2="336" y2="264" class="solid"></line>
    <line x1="344" y1="264" x2="352" y2="264" class="solid"></line>
    <line x1="360" y1="264" x2="368" y2="264" class="solid"></line>
    <line x1="376" y1="264" x2="384" y2="264" class="solid"></line>
    <line x1="392" y1="264" x2="400" y2="264" class="solid"></line>
    <line x1="408" y1="264" x2="416" y2="264" class="solid"></line>
    <line x1="440" y1="264" x2="448" y2="264" class="solid"></line>
    <line x1="456" y1="264" x2="464" y2="264" class="solid"></line>
    <line x1="472" y1="264" x2="480" y2="264" class="solid"></line>
    <line x1="488" y1="264" x2="496" y2="264" class="solid"></line>
    <line x1="504" y1="264" x2="512" y2="264" class="solid"></line>
    <line x1="520" y1="264" x2="528" y2="264" class="solid"></line>
    <line x1="600" y1="264" x2="608" y2="264" class="solid"></line>
    <line x1="616" y1="264" x2="624" y2="264" class="solid"></line>
    <line x1="224" y1="360" x2="232" y2="360" class="solid"></line>
    <line x1="240" y1="360" x2="248" y2="360" class="solid"></line>
    <line x1="256" y1="360" x2="264" y2="360" class="solid"></line>
    <line x1="272" y1="360" x2="280" y2="360" class="solid"></line>
    <line x1="288" y1="360" x2="296" y2="360" class="solid"></line>
    <line x1="304" y1="360" x2="312" y2="360" class="solid"></line>
    <line x1="320" y1="360" x2="328" y2="360" class="solid"></line>
    <line x1="336" y1="360" x2="344" y2="360" class="solid"></line>
    <line x1="352" y1="360" x2="360" y2="360" class="solid"></line>
    <line x1="368" y1="360" x2="376" y2="360" class="solid"></line>
    <line x1="384" y1="360" x2="392" y2="360" class="solid"></line>
    <line x1="400" y1="360" x2="408" y2="360" class="solid"></line>
    <line x1="416" y1="360" x2="424" y2="360" class="solid"></line>
    <line x1="432" y1="360" x2="440" y2="360" class="solid"></line>
    <line x1="448" y1="360" x2="456" y2="360" class="solid"></line>
    <line x1="464" y1="360" x2="472" y2="360" class="solid"></line>
    <line x1="480" y1="360" x2="488" y2="360" class="solid"></line>
    <line x1="496" y1="360" x2="504" y2="360" class="solid"></line>
    <line x1="512" y1="360" x2="520" y2="360" class="solid"></line>
    <line x1="528" y1="360" x2="536" y2="360" class="solid"></line>
    <line x1="544" y1="360" x2="552" y2="360" class="solid"></line>
    <line x1="560" y1="360" x2="568" y2="360" class="solid"></line>
    <line x1="576" y1="360" x2="584" y2="360" class="solid"></line>
    <line x1="592" y1="360" x2="600" y2="360" class="solid"></line>
    <line x1="608" y1="360" x2="616" y2="360" class="solid"></line>
    <line x1="624" y1="360" x2="632" y2="360" class="solid"></line>
    <line x1="640" y1="360" x2="648" y2="360" class="solid"></line>
    <line x1="656" y1="360" x2="664" y2="360" class="solid"></line>
    <line x1="672" y1="360" x2="680" y2="360" class="solid"></line>
    <text x="770" y="188" >rustBoot</text>
    <text x="842" y="188" >provides</text>
    <text x="914" y="188" >a</text>
    <text x="770" y="204" >tiny</text>
    <text x="810" y="204" >api</text>
    <text x="842" y="204" >to</text>
    <text x="866" y="204" >trigger</text>
    <text x="770" y="220" >and</text>
    <text x="802" y="220" >confirm</text>
    <text x="866" y="220" >updates</text>
    <line x1="536" y1="264" x2="544" y2="264" class="solid"></line>
    <line x1="552" y1="264" x2="560" y2="264" class="solid"></line>
    <line x1="568" y1="264" x2="576" y2="264" class="solid"></line>
    <line x1="584" y1="264" x2="592" y2="264" class="solid"></line>
    <line x1="632" y1="264" x2="640" y2="264" class="solid"></line>
    <line x1="648" y1="264" x2="656" y2="264" class="solid"></line>
    <line x1="664" y1="264" x2="672" y2="264" class="solid"></line>
    <line x1="680" y1="264" x2="688" y2="264" class="solid"></line>
    <text x="50" y="300" >Transport</text>
    <text x="66" y="316" >Options</text>
    <g>
        <line x1="8" y1="24" x2="16" y2="24" class="solid"></line>
        <polygon points="16,20 24,24 16,28" class="filled"></polygon>
    </g>
    <g>
        <line x1="612" y1="144" x2="612" y2="164" class="solid"></line>
        <polygon points="608,164 616,164 612,176" class="filled"></polygon>
    </g>
    <g>
        <line x1="428" y1="176" x2="428" y2="260" class="solid"></line>
        <polygon points="424,260 432,260 428,272" class="filled"></polygon>
    </g>
    <g>
        <path d="M 216,280 A 4,4 0,0,0 212,284" class="nofill"></path>
        <line x1="212" y1="284" x2="212" y2="340" class="solid"></line>
        <line x1="216" y1="280" x2="520" y2="280" class="solid"></line>
        <path d="M 520,280 A 4,4 0,0,1 524,284" class="nofill"></path>
        <line x1="524" y1="284" x2="524" y2="340" class="solid"></line>
        <path d="M 212,340 A 4,4 0,0,0 216,344" class="nofill"></path>
        <line x1="216" y1="344" x2="520" y2="344" class="solid"></line>
        <path d="M 524,340 A 4,4 0,0,1 520,344" class="nofill"></path>
        <polygon points="144,308 136,312 144,316" class="filled"></polygon>
        <line x1="144" y1="312" x2="212" y2="312" class="solid"></line>
    </g>
    <g>
        <line x1="612" y1="272" x2="612" y2="340" class="solid"></line>
        <polygon points="608,340 616,340 612,352" class="filled"></polygon>
    </g>
    <g>
        <line x1="688" y1="200" x2="744" y2="200" class="solid"></line>
        <polygon points="744,196 752,200 744,204" class="filled"></polygon>
    </g>
</svg></pre>
<blockquote>
<p><strong>Notes:</strong></p>
<ul>
<li>rustBoot <code>can replace U-boot</code> in a trust-chain i.e. it can easily be integrated into an existing trust-chain, wherever U-boot is used.</li>
<li>As it has a very small hardware abstraction layer, it is highly portable across Cortex-M and Cortex-A architectures. </li>
<li>Public-key hashes or trust anchors can be stored in secure hardware or embedded in software.</li>
<li>Hardware drivers for different types of secure-hardware (ex: crypto elements) will be made available via the HAL. </li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rustboot-images"><a class="header" href="#rustboot-images">rustBoot Images</a></h1>
<p>rustBoot images comprise of a <code>256-byte header</code> pre-pended to a firmware binary and are deliberately designed to be as simple as possible. </p>
<ul>
<li>it does not rely on the use of complex digital certificate formats to <a href="arch/../index.html#trusted-computing-base"><code>reduce its TCB</code></a> and avoids uneccessary <a href="arch/../index.html#complexity--boot-time">code-complexity</a></li>
</ul>
<pre class="svgbob"><style>text{fill:var(--fg)}</style><svg xmlns="http://www.w3.org/2000/svg" width="1216" height="464">
    <style>
        line, path, circle, rect, polygon{stroke:var(--fg);stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter;}text{font-family:Lucida Console;font-size:14px;}rect.backdrop{stroke:none;fill:transparent;}.broken{stroke-dasharray:8;}.filled{fill:black;}.bg_filled{fill:transparent;}.nofill{fill:transparent;}.end_marked_arrow{marker-end:url(#arrow);}.start_marked_arrow{marker-start:url(#arrow);}.end_marked_diamond{marker-end:url(#diamond);}.start_marked_diamond{marker-start:url(#diamond);}.end_marked_circle{marker-end:url(#circle);}.start_marked_circle{marker-start:url(#circle);}.end_marked_open_circle{marker-end:url(#open_circle);}.start_marked_open_circle{marker-start:url(#open_circle);}.end_marked_big_open_circle{marker-end:url(#big_open_circle);}.start_marked_big_open_circle{marker-start:url(#big_open_circle);}
        <!--separator-->
        
    </style>
    <defs>
        <marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,0 0,4 4,2 0,0"></polygon>
        </marker>
        <marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,2 2,0 4,2 2,4 0,2"></polygon>
        </marker>
        <marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="filled"></circle>
        </marker>
        <marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="bg_filled"></circle>
        </marker>
        <marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="3" class="bg_filled"></circle>
        </marker>
    </defs>
    <rect class="backdrop" x="0" y="0" width="1216" height="464"></rect>
    <circle cx="4" cy="24" r="3" class="nofill"></circle>
    <text x="42" y="28" >Simplified</text>
    <text x="130" y="28" >Block</text>
    <text x="178" y="28" >Diagram,</text>
    <text x="250" y="28" >256</text>
    <text x="282" y="28" >byte</text>
    <text x="322" y="28" >rustBoot</text>
    <text x="394" y="28" >header:</text>
    <line x1="24" y1="72" x2="32" y2="72" class="solid"></line>
    <line x1="40" y1="72" x2="48" y2="72" class="solid"></line>
    <line x1="88" y1="72" x2="96" y2="72" class="solid"></line>
    <line x1="104" y1="72" x2="112" y2="72" class="solid"></line>
    <line x1="120" y1="72" x2="128" y2="72" class="solid"></line>
    <line x1="1176" y1="72" x2="1184" y2="72" class="solid"></line>
    <text x="18" y="92" >MAGIC</text>
    <text x="82" y="92" >IMG</text>
    <text x="114" y="92" >SIZE</text>
    <text x="170" y="92" >TLV</text>
    <text x="218" y="92" >IMG</text>
    <text x="250" y="92" >VER</text>
    <text x="298" y="92" >PAD</text>
    <text x="346" y="92" >TLV</text>
    <text x="394" y="92" >TIMESTAMP</text>
    <text x="490" y="92" >TLV</text>
    <text x="538" y="92" >IMG</text>
    <text x="570" y="92" >TYPE</text>
    <text x="626" y="92" >PAD</text>
    <text x="674" y="92" >TLV</text>
    <text x="722" y="92" >SHA256</text>
    <text x="778" y="92" >DIGEST</text>
    <text x="850" y="92" >TLV</text>
    <text x="898" y="92" >PUBKEY</text>
    <text x="954" y="92" >DIGEST</text>
    <text x="1026" y="92" >TLV</text>
    <text x="1074" y="92" >SIGNATURE</text>
    <text x="1170" y="92" >EOH</text>
    <line x1="24" y1="104" x2="32" y2="104" class="solid"></line>
    <line x1="40" y1="104" x2="48" y2="104" class="solid"></line>
    <line x1="88" y1="104" x2="96" y2="104" class="solid"></line>
    <line x1="104" y1="104" x2="112" y2="104" class="solid"></line>
    <line x1="120" y1="104" x2="128" y2="104" class="solid"></line>
    <line x1="1176" y1="104" x2="1184" y2="104" class="solid"></line>
    <text x="274" y="268" >256</text>
    <text x="306" y="268" >BYTE</text>
    <text x="346" y="268" >RUSTBOOT</text>
    <text x="418" y="268" >HEADER</text>
    <text x="578" y="268" >FIRMWARE</text>
    <text x="650" y="268" >IMAGE</text>
    <text x="386" y="380" >all</text>
    <text x="418" y="380" >valid</text>
    <text x="466" y="380" >rustBoot</text>
    <text x="538" y="380" >images</text>
    <text x="386" y="396" >are</text>
    <text x="418" y="396" >composed</text>
    <text x="490" y="396" >of</text>
    <text x="514" y="396" >a</text>
    <text x="530" y="396" >256</text>
    <text x="562" y="396" >byte</text>
    <text x="386" y="412" >header</text>
    <text x="442" y="412" >prepended</text>
    <text x="522" y="412" >to</text>
    <text x="546" y="412" >an</text>
    <text x="386" y="428" >executable</text>
    <text x="474" y="428" >firmware</text>
    <text x="386" y="444" >binary.</text>
    <g>
        <line x1="8" y1="24" x2="16" y2="24" class="solid"></line>
        <polygon points="16,20 24,24 16,28" class="filled"></polygon>
    </g>
    <g>
        <line x1="4" y1="72" x2="16" y2="72" class="solid"></line>
        <line x1="4" y1="72" x2="4" y2="104" class="solid"></line>
        <line x1="4" y1="104" x2="16" y2="104" class="solid"></line>
    </g>
    <g>
        <line x1="56" y1="72" x2="80" y2="72" class="solid"></line>
        <line x1="68" y1="72" x2="68" y2="104" class="solid"></line>
        <line x1="56" y1="104" x2="80" y2="104" class="solid"></line>
    </g>
    <g>
        <line x1="136" y1="72" x2="1168" y2="72" class="solid"></line>
        <line x1="156" y1="72" x2="156" y2="104" class="solid"></line>
        <line x1="204" y1="72" x2="204" y2="104" class="solid"></line>
        <line x1="284" y1="72" x2="284" y2="104" class="solid"></line>
        <line x1="332" y1="72" x2="332" y2="104" class="solid"></line>
        <line x1="380" y1="72" x2="380" y2="104" class="solid"></line>
        <line x1="476" y1="72" x2="476" y2="104" class="solid"></line>
        <line x1="524" y1="72" x2="524" y2="104" class="solid"></line>
        <line x1="612" y1="72" x2="612" y2="104" class="solid"></line>
        <line x1="660" y1="72" x2="660" y2="104" class="solid"></line>
        <line x1="708" y1="72" x2="708" y2="104" class="solid"></line>
        <line x1="836" y1="72" x2="836" y2="104" class="solid"></line>
        <line x1="884" y1="72" x2="884" y2="104" class="solid"></line>
        <line x1="1012" y1="72" x2="1012" y2="104" class="solid"></line>
        <line x1="1060" y1="72" x2="1060" y2="104" class="solid"></line>
        <line x1="1156" y1="72" x2="1156" y2="104" class="solid"></line>
        <line x1="136" y1="104" x2="1168" y2="104" class="solid"></line>
    </g>
    <g>
        <line x1="1192" y1="72" x2="1204" y2="72" class="solid"></line>
        <line x1="1204" y1="72" x2="1204" y2="104" class="solid"></line>
        <line x1="1192" y1="104" x2="1204" y2="104" class="solid"></line>
    </g>
    <g>
        <line x1="548" y1="112" x2="548" y2="180" class="solid"></line>
        <path d="M 376,184 A 4,4 0,0,0 372,188" class="nofill"></path>
        <line x1="372" y1="188" x2="372" y2="228" class="solid"></line>
        <line x1="376" y1="184" x2="544" y2="184" class="solid"></line>
        <path d="M 548,180 A 4,4 0,0,1 544,184" class="nofill"></path>
        <polygon points="368,228 376,228 372,240" class="filled"></polygon>
    </g>
    <g>
        <line x1="260" y1="248" x2="788" y2="248" class="solid"></line>
        <line x1="260" y1="248" x2="260" y2="280" class="solid"></line>
        <line x1="476" y1="248" x2="476" y2="280" class="solid"></line>
        <line x1="788" y1="248" x2="788" y2="280" class="solid"></line>
        <line x1="260" y1="280" x2="788" y2="280" class="solid"></line>
    </g>
    <g>
        <line x1="476" y1="304" x2="476" y2="340" class="solid"></line>
        <polygon points="472,340 480,340 476,352" class="filled"></polygon>
    </g>
</svg></pre>
<h3 id="rustboot-image-header-layout"><a class="header" href="#rustboot-image-header-layout">rustBoot Image header layout:</a></h3>
<p>The header always starts with a 4-byte magic number, followed by a 4-byte field indicating the size of the firmware image (excluding the header). All header contents are stored in little-endian format.</p>
<p>The 2 (<code>magic and size</code>) fixed fields are followed by one or more <code>TLV(s) or Type, Length, Value</code> tags. A TLV has the following layout</p>
<ul>
<li><strong>Type:</strong> 2 bytes to indicate the <code>Type</code> of the tag</li>
<li><strong>Length:</strong> 2 bytes to indicate the <code>length in bytes</code> of the tag (excluding the type and size bytes).</li>
<li><strong>Value:</strong> N bytes of tag content</li>
</ul>
<h3 id="padding-and-end-of-header-bytes"><a class="header" href="#padding-and-end-of-header-bytes">Padding and End of Header bytes:</a></h3>
<ul>
<li>An <code>0xFF</code> byte in the <code>Type</code> field indicates a padding byte. A ‘padding’ byte does <em>NOT</em> have a size field, and the next byte is interpreted as <code>Type</code> again.</li>
<li>A 2 byte value of <code>0x0000</code> signals the end of the rustBoot header. </li>
</ul>
<h3 id="tags"><a class="header" href="#tags">Tags:</a></h3>
<p>Each tag represents some information about the firmware. <code>rustBoot</code> requires the following <code>Tags</code> for firmware validation:</p>
<ul>
<li>The <code>version</code> tag provides firmware version number information.
<ul>
<li>Type: <code>0x0001</code></li>
<li>Length: 4 bytes</li>
</ul>
</li>
<li>The <code>timestamp</code> tag provides the timestamp in unix seconds for when the <code>rustBoot image</code> was created.
<ul>
<li>Type: <code>0x0002</code></li>
<li>Length: 8 bytes</li>
</ul>
</li>
<li>The <code>auth type</code> tag identifies the type of the authentication mechanism in use. Ex: which ECC curve are we using and what’s the key strength etc.
<ul>
<li>Type: <code>0x0030</code></li>
<li>Length: 2 bytes</li>
</ul>
</li>
<li>The <code>sha256 digest</code> tag contains a <code>SHA2 hash</code> of the firmware and is used to check firmware integrity.
<ul>
<li>Type: <code>0x0003</code></li>
<li>Length: <code>32 bytes</code></li>
</ul>
</li>
<li>The <code>firmware signature</code> tag contains the <code>ECC signature</code> and is used to verify firmware against a known public key.
<ul>
<li>Type: <code>0x0020</code></li>
<li>Length: 64 bytes</li>
</ul>
</li>
</ul>
<h3 id="optional-tags"><a class="header" href="#optional-tags">Optional Tags:</a></h3>
<ul>
<li><strong>Pubkey Hint:</strong> A <code>pubkey hint digest</code> tag can be included in the header.
<ul>
<li>Type: <code>0x1000</code></li>
<li>Length: 32 bytes</li>
<li>This tag contains the SHA256 digest of the public key of the corresponding private-key used by the signing tool. The bootloader may use this field to locate the correct public key in case multiple keys are available.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>rustBoot Defaults:</strong> </p>
<ul>
<li>By default, a valid rustBoot image is always signed.</li>
<li>It relies on the 256-byte header for firmware validation.</li>
<li>It will fail to boot an image
<ul>
<li>if it does not possess a <a href="arch/images.html#rustboot-images"><code>valid rustBoot header</code></a> or</li>
<li>if it isn’t signed or if it cannot be verified using the included the <a href="arch/images.html#tags"><code>authentication-type</code></a>.</li>
</ul>
</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rustboot-partitions"><a class="header" href="#rustboot-partitions">rustBoot Partitions</a></h1>
<p><code>rustBoot</code> offers 2 <code>update-types</code>, depending on the type of the underlying system.</p>
<ul>
<li>
<p><strong>micro-controller updates:</strong> uses the concept of <a href="https://github.com/nihalpasham/rustBoot/issues/2"><code>swappable flash partitions</code></a> to update micro-controller firmware. </p>
<blockquote>
<p>This usually means bare-metal firmware but it is also applicable to <code>RTOS(s)</code>.</p>
</blockquote>
</li>
<li>
<p><strong>linux system updates:</strong> uses the traditional <code>ram based swap</code> method to update linux distributions running atop micro-processors.</p>
</li>
</ul>
<h2 id="micro-controller-updates"><a class="header" href="#micro-controller-updates">Micro-controller Updates:</a></h2>
<pre class="svgbob"><style>text{fill:var(--fg)}</style><svg xmlns="http://www.w3.org/2000/svg" width="824" height="112">
    <style>
        line, path, circle, rect, polygon{stroke:var(--fg);stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter;}text{font-family:Lucida Console;font-size:14px;}rect.backdrop{stroke:none;fill:transparent;}.broken{stroke-dasharray:8;}.filled{fill:black;}.bg_filled{fill:transparent;}.nofill{fill:transparent;}.end_marked_arrow{marker-end:url(#arrow);}.start_marked_arrow{marker-start:url(#arrow);}.end_marked_diamond{marker-end:url(#diamond);}.start_marked_diamond{marker-start:url(#diamond);}.end_marked_circle{marker-end:url(#circle);}.start_marked_circle{marker-start:url(#circle);}.end_marked_open_circle{marker-end:url(#open_circle);}.start_marked_open_circle{marker-start:url(#open_circle);}.end_marked_big_open_circle{marker-end:url(#big_open_circle);}.start_marked_big_open_circle{marker-start:url(#big_open_circle);}
        <!--separator-->
        
    </style>
    <defs>
        <marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,0 0,4 4,2 0,0"></polygon>
        </marker>
        <marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <polygon points="0,2 2,0 4,2 2,4 0,2"></polygon>
        </marker>
        <marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="filled"></circle>
        </marker>
        <marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="2" class="bg_filled"></circle>
        </marker>
        <marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <circle cx="4" cy="4" r="3" class="bg_filled"></circle>
        </marker>
    </defs>
    <rect class="backdrop" x="0" y="0" width="824" height="112"></rect>
    <circle cx="4" cy="24" r="3" class="nofill"></circle>
    <text x="42" y="28" >Simplified</text>
    <text x="130" y="28" >Block</text>
    <text x="178" y="28" >Diagram,</text>
    <text x="250" y="28" >rustBoot</text>
    <text x="322" y="28" >MCU</text>
    <text x="354" y="28" >flash</text>
    <text x="402" y="28" >partitioning:</text>
    <text x="106" y="76" >rustBoot</text>
    <text x="178" y="76" >Partition</text>
    <text x="314" y="76" >BOOT</text>
    <text x="354" y="76" >Partition</text>
    <text x="498" y="76" >UPDATE</text>
    <text x="554" y="76" >Partition</text>
    <text x="682" y="76" >SWAP</text>
    <text x="722" y="76" >Partition</text>
    <g>
        <line x1="8" y1="24" x2="16" y2="24" class="solid"></line>
        <polygon points="16,20 24,24 16,28" class="filled"></polygon>
    </g>
    <g>
        <line x1="84" y1="56" x2="812" y2="56" class="solid"></line>
        <line x1="84" y1="56" x2="84" y2="88" class="solid"></line>
        <line x1="268" y1="56" x2="268" y2="88" class="solid"></line>
        <line x1="460" y1="56" x2="460" y2="88" class="solid"></line>
        <line x1="660" y1="56" x2="660" y2="88" class="solid"></line>
        <line x1="812" y1="56" x2="812" y2="88" class="solid"></line>
        <line x1="84" y1="88" x2="812" y2="88" class="solid"></line>
    </g>
</svg></pre>
<blockquote>
<p>Note: <code>BOOT</code>, <code>UPDATE</code> and <code>SWAP</code> partitions need not be consecutively laid out in flash memory. The above diagram only serves as a visual aid.</p>
</blockquote>
<p>rustBoot requires <code>mcu flash</code> to be divided into (at-least) 4 non-overlapping memory regions (i.e. partitions). </p>
<ul>
<li><code>rustBoot</code>: contains the bootloader. This starts starts at <code>address 0x0</code> in flash. </li>
<li><code>BOOT:</code> contains boot firmware. <code>rustBoot</code> always boots from this partition address.</li>
<li><code>UPDATE:</code> contains update firmware i.e. downloaded update firmware is placed in this partition.</li>
<li><code>SWAP:</code> is an empty partition that is used while swapping contents of <code>BOOT</code> and <code>UPDATE</code>.</li>
</ul>
<p>All 3 partition boundaries must be aligned to a physical sector as <code>rustBoot</code> erases all flash sectors prior to storing a new firmware image, and swaps the contents of the two partitions, one sector at a time.</p>
<p>To ensure partition-sector aligments are maintained, before proceeding to partition a target system, the following points must be considered:</p>
<ul>
<li><code>BOOT and UPDATE</code> partition must be of the same size.</li>
<li><code>SWAP</code> partition <code>must be larger than the largest sector</code> in either <code>BOOT</code> or <code>UPDATE</code> partition.</li>
</ul>
<p>MCU flash memory is partitioned as follows:</p>
<ul>
<li>rustBoot partition starts at <code>address 0x0</code> in flash memory. It should be at least 32KB in size.</li>
<li><code>BOOT</code> partition starts at a pre-defined address - <a href="https://github.com/nihalpasham/rustBoot/blob/7ea124b2d8f82b85b5500bfdbc038c104eee4452/rustBoot/src/constants.rs#L8"><code>BOOT_PARTITION_ADDRESS</code></a></li>
<li><code>UPDATE</code> partition starts at a pre-defined address - <a href="https://github.com/nihalpasham/rustBoot/blob/7ea124b2d8f82b85b5500bfdbc038c104eee4452/rustBoot/src/constants.rs#L10"><code>UPDATE_PARTITION_ADDRESS</code></a>
<ul>
<li>both partitions must be of the same size, defined by <a href="https://github.com/nihalpasham/rustBoot/blob/7ea124b2d8f82b85b5500bfdbc038c104eee4452/rustBoot/src/constants.rs#L6"><code>PARTITION_SIZE</code></a></li>
</ul>
</li>
<li><code>SWAP</code> partition starts at a predefined address - <a href="https://github.com/nihalpasham/rustBoot/blob/7ea124b2d8f82b85b5500bfdbc038c104eee4452/rustBoot/src/constants.rs#L9"><code>SWAP_PARTITION_ADDRESS</code></a>
<ul>
<li>swap-space size is defined by <a href="https://github.com/nihalpasham/rustBoot/blob/7ea124b2d8f82b85b5500bfdbc038c104eee4452/rustBoot/src/constants.rs#L5"><code>SECTOR_SIZE</code></a> and must be larger than the largest sector in either <code>BOOT</code> or <code>UPDATE</code> partition.</li>
</ul>
</li>
</ul>
<p>BOOT, UPDATE, SWAP addresses and SECTOR_SIZE, PARTITION_SIZE values can be set via command line options or developers <code>constants.rs</code>.</p>
<blockquote>
<p><strong>rustBoot Defaults:</strong></p>
<ul>
<li>By default, public keys used for firmware validation are embedded in <code>rustBoot-firmware</code> during a factory-image-burn. However, rustBoot also offers the option to retrieve them from secure-hardware (ex: crypto-elements).</li>
<li>The <code>BOOT</code> partiton is the only partition from which we can boot a firmware image. The firmware image must be linked so that its entry-point is at address <code>256 + BOOT_PARTITION_ADDRESS</code>.</li>
<li><code>BOOT</code> firmware is responsible for downloading a new firmware image via a secure channel and installing it in the <code>UPDATE</code> partition. To trigger an update, the <code>BOOT</code> firmware updates the <code>status byte</code> of the <code>UPDATE</code> partition and performs a reboot. This will allow the bootloader to <code>swap the contents</code> of <code>BOOT</code> partition with that of the <code>UPDATE</code> partition. </li>
</ul>
</blockquote>
<h2 id="linux-system-updates"><a class="header" href="#linux-system-updates">Linux System Updates:</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rustboot-boot-flow"><a class="header" href="#rustboot-boot-flow">rustBoot Boot Flow</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rustboot-update-flow"><a class="header" href="#rustboot-update-flow">rustBoot Update Flow</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signing-utilities"><a class="header" href="#signing-utilities">Signing Utilities</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-guide"><a class="header" href="#user-guide">User Guide</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nrf52840"><a class="header" href="#nrf52840">nrf52840</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rpi4"><a class="header" href="#rpi4">rpi4</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="secure-coding-guidelines"><a class="header" href="#secure-coding-guidelines">Secure Coding guidelines</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="continuous-integration"><a class="header" href="#continuous-integration">Continuous Integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="for-developers"><a class="header" href="#for-developers">For Developers</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reference-guide"><a class="header" href="#reference-guide">Reference Guide</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributors"><a class="header" href="#contributors">Contributors</a></h1>
<p>Here is a list of the contributors who have helped improve <code>rustBoot</code>. Big shout-out to them!</p>
<pre><code class="language-markdown">Add Names
</code></pre>
<p>If you feel you’re missing from this list, feel free to add yourself in a PR.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
